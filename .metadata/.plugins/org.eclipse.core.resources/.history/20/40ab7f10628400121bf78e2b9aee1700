package com.findCache;

import java.util.List;

import com.data.DataClass;
import com.data.Model;
import com.data.SegMathClass;
import com.google.android.maps.GeoPoint;
import com.vectorone.R;

import android.content.Context;
import android.content.res.Resources;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.graphics.Canvas;
import android.graphics.Color;
import android.graphics.Paint;
import android.location.Location;
import android.util.Log;
import android.view.View;
import android.widget.Toast;

public class RadarTargetOverlay extends View {
	private double distanc;
	private double degree;
	private double diffx;
	private double diffy;
	private float midx = 160;
	private float midy = 240;
	private String[][] distancelabels = { { "10", "20", "30", "40" },
			{ "50", "100", "150", "200" }, { "500", "1000", "1500", "2000" },
			{ "5000", "10000", "15000", "20000" } };
	private int zoomlevel;

	public RadarTargetOverlay(Context context, int zoomlevel) {
		super(context);
		this.zoomlevel = zoomlevel;
		// TODO Auto-generated constructor stub
	}

	@Override
	protected void onDraw(Canvas canvas) {
		// TODO Auto-generated method stub
		Paint paint = new Paint();
		paint.setStyle(Paint.Style.FILL);
		paint.setAntiAlias(true);
		Resources res = getResources();
		Bitmap bitmap = BitmapFactory.decodeResource(res,
				R.drawable.treasureclosed);
		Toast.makeText(getContext(), "asd" + DataClass.caches.size(),
				Toast.LENGTH_SHORT).show();
		
		for (int i = 0; i < DataClass.selectedCaches.size(); i++) {
			GeoPoint gp = DataClass.selectedCaches.get(i).getGeopoint();
			calculate(gp);
			canvas.drawBitmap(bitmap, (float) diffx + midx , (float) diffy
					+ midy , paint);
		}

		super.onDraw(canvas);
	}

	private void calculate(GeoPoint gp) {

		GeoPoint mygp = DataClass.myGeoPoint;
		distanc = SegMathClass.calculateDistanceinMeter(mygp, gp);
		degree = SegMathClass.calculateDirectionDegree(mygp, gp) - 90;
		// Log.i("RADAR", "degree="+degree);
		// Log.i("RADAR",
		// "Scale="+Integer.parseInt(distancelabels[distancelabels.length-zoomlevel][3]));
		diffx = 200
				* distanc
				* Math.cos(degree / 360 * 2 * Math.PI)
				/ Integer.parseInt(distancelabels[distancelabels.length
						- zoomlevel][3]);
		diffy = 200
				* distanc
				* Math.sin(degree / 360 * 2 * Math.PI)
				/ Integer.parseInt(distancelabels[distancelabels.length
						- zoomlevel][3]);
		 //Log.i("RADAR", "x="+diffx);
		// Log.i("RADAR", "y="+diffy);
		 //Log.i("RADAR", "distance="+distanc );

	}

}
