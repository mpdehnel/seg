package com.vectorone;

import com.data.Cache;
import com.data.DataClass;
import com.data.DatabaseCacheHandler;
import com.data.Model;
import com.data.MyHttpClient;
import com.google.android.maps.GeoPoint;

import android.content.Context;
import android.content.Intent;
import android.os.CountDownTimer;
import android.widget.TextView;
import android.widget.Toast;

public class loadingtimer extends CountDownTimer {

	private MyHttpClient httpClient = new MyHttpClient(DataClass.server);
	private TextView prozent;
	private long millisInFuture;
	private Context cx;
	private String username;
	private MainLogInActivity main;

	public loadingtimer(long millisInFuture, long countDownInterval,
			String username, String password, MainLogInActivity main) {
		super(millisInFuture, countDownInterval);
		main.setContentView(R.layout.loading_activity);
		this.millisInFuture = millisInFuture;
		this.prozent = (TextView) main.findViewById(R.id.progresstext);
		this.cx=main.getApplicationContext();
		this.username=username;
		this.main=main;
		/*try {
			if (httpClient.isUser(username, password)) {

				DatabaseCacheHandler dbhandler = new DatabaseCacheHandler(cx);
				try {
					DataClass.addCachesFromDataBase(httpClient
							.getCachesfromDatabase("test"));
					dbhandler.remove();
					dbhandler = new DatabaseCacheHandler(cx);
					for (int i = 0; i < DataClass.caches.size(); i++) {
						dbhandler.addCache(DataClass.caches.get(i).getCach());
					}

				} catch (Exception e) {

					dbhandler.getAllCache();

				}
				DataClass.caches.add(new Model(new Cache("DurhamUniversitaet",
						new GeoPoint(54767542, -1571993), // new GeoPoint(
						// 54767442, -1570993),
						"thats CLC Main Entry", false, 666)));
				// finish();

			} else {
				main.setContentView(R.layout.activity_login);
				Toast.makeText(cx, "Unkown User/Password combination",
						Toast.LENGTH_LONG).show();
			}
		} catch (Exception e) {
			main.setContentView(R.layout.activity_login);
			Toast.makeText(cx, "No internet ", Toast.LENGTH_LONG).show();
		}*/

	}

	@Override
	public void onFinish() {
		main.finish();
		Intent intent = new Intent(cx, MenuActivity.class);
		intent.putExtra("username", username);
		cx.startActivity(intent);
	}

	@Override
	public void onTick(long millisUntilFinished) {
		prozent.setText((millisInFuture - millisUntilFinished) / millisInFuture
				* 100 + "%");
	}

}
