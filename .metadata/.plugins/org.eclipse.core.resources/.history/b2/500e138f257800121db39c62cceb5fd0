package com.maps.route;

import java.io.IOException;
import java.io.InputStream;
import java.net.MalformedURLException;
import java.net.URL;
import java.net.URLConnection;

import android.os.Handler;

public class RoutingThread {
	private Road mRoad;
	private Handler mHandler;
	private Thread routin;

	public RoutingThread(final double fromLat, final double fromLon,
			final double toLat, final double toLon) {
		setUpHandler();
		routin = new Thread() {

			@Override
			public void run() {
				String url = RoadProvider
						.getUrl(fromLat, fromLon, toLat, toLon);
				InputStream is = getConnection(url);
				mRoad = RoadProvider.getRoute(is);
				mHandler.sendEmptyMessage(0);
			}
		};
	}

	private InputStream getConnection(String url) {
		InputStream is = null;
		try {
			URLConnection conn = new URL(url).openConnection();
			is = conn.getInputStream();
		} catch (MalformedURLException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
		return is;
	}

	public void setUpHandler() {
		mHandler = new Handler() {
			public void handleMessage(android.os.Message msg) {
				// textView.setText(mRoad.mName + " " + mRoad.mDescription);
				MapOverlay mapOverlay = new MapOverlay(mRoad, mapView);
				List<Overlay> listOfOverlays = mapView.getOverlays();
				listOfOverlays.clear();
				listOfOverlays.add(mapOverlay);
				mapView.invalidate();
			};
		};
	}

	private void start() {
		routin.start();
	}

}
